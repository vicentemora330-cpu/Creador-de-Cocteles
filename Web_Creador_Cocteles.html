<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de C√≥cteles - Bar Manager</title>
    
    <!-- Fuentes: Inter (General) y Poppins (T√≠tulos) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        /* --- ESTILOS VISUALES: MIXOLOGY REDESIGN --- */

        /* 1. Paleta de Colores y Variables Globales */
        :root {
            --bg-main: #0D0D0D;           /* Negro suave (Fondo) */
            --bg-glass: rgba(29, 29, 29, 0.7); /* Panel glassmorphism */
            --bg-glass-light: rgba(42, 42, 42, 0.8); /* Botones/headers */
            --color-primary: #C94C26;     /* Cobre/Naranja (Bot√≥n principal) */
            --color-accent: #E3B23C;      /* Dorado (Acentos, t√≠tulos) */
            --text-primary: #F5F5F5;      /* Blanco Humo (Texto) */
            --text-secondary: #AAAAAA;    /* Gris (Texto secundario) */
            --border-color: #444444;      /* Borde desactivado */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            min-height: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-main) url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"%3E%3Cg fill-rule="evenodd"%3E%3Cg fill="%231a1a1a" fill-opacity="0.4"%3E%3Cpath d="M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            color: var(--text-primary);
            line-height: 1.6;
            padding: 1rem;
            padding-bottom: 3rem;
        }

        /* 2. Contenedor Principal y Encabezado */
        .bartender-app {
            max-width: 800px; 
            margin: 0 auto;
            display: flex;
            flex-direction: column;
        }

        header {
            text-align: center;
            margin-bottom: 1rem;
        }

        header h1 {
            font-family: 'Poppins', sans-serif;
            color: var(--color-accent);
            font-weight: 400;
            letter-spacing: 2px;
            font-size: 1.75rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        /* 3. Panel Principal (Glassmorphism) */
        .main-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
            display: flex;
            flex-direction: column;
        }

        /* 4. Inputs Superiores (Nombre, Bartender) */
        .top-inputs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .input-group {
            flex: 1;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.3rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .input-group input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-main);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 10px;
            font-size: 0.95rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .input-group input[type="text"]:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 10px rgba(201, 76, 38, 0.5); /* Sombra Cobre */
        }

        /* 5. Panel de Receta (Tarjeta Elegante) */
        .recipe-container {
            background: var(--bg-main);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
        }

        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 0.5rem;
            gap: 10px;
        }

        .recipe-header h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            color: var(--color-accent);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
            flex-shrink: 0;
        }

        /* Contenedor para las etiquetas de pie de receta */
        .recipe-tags-footer {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem; /* Espacio antes del bot√≥n copiar */
        }
        
        .prep-tag-footer {
            display: none; /* Oculto por defecto */
            font-size: 0.8rem;
            font-weight: 700;
            padding: 5px 10px;
            border-radius: 5px;
            text-transform: uppercase;
            text-align: center;
            width: fit-content;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }
        
        /* Etiqueta Preparaci√≥n */
        #preparationTag {
            background: var(--color-primary);
            color: var(--bg-main);
        }

        /* Etiqueta Cristaler√≠a */
        #glassTag {
            background: var(--color-accent);
            color: var(--bg-main);
        }
        
        .recipe-output {
            max-height: 300px; 
            overflow-y: auto;
            margin-bottom: 0.8rem;
            padding-right: 5px;
        }

        .recipe-output .placeholder {
            color: var(--border-color);
            text-align: center;
            font-style: italic;
            font-size: 0.9rem;
            padding: 1rem;
        }

        .recipe-item {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 0.4rem;
            font-size: 0.95rem;
            color: var(--text-primary);
            animation: slideIn 0.2s ease-out forwards;
        }

        .recipe-item .amount { 
            color: var(--color-primary); /* Medida en Cobre */
            font-weight: 700; 
        }
        
        /* Bot√≥n Copiar (Principal de Receta) con Pulso */
        @keyframes pulse-primary {
            0% { box-shadow: 0 0 0 0 rgba(201, 76, 38, 0.7); } /* --color-primary */
            70% { box-shadow: 0 0 0 10px rgba(201, 76, 38, 0); }
            100% { box-shadow: 0 0 0 0 rgba(201, 76, 38, 0); }
        }

        .copy-btn {
            width: 100%;
            padding: 0.8rem;
            font-size: 0.9rem;
            font-weight: 600;
            background-color: var(--color-primary); /* Color Cobre */
            color: var(--text-primary);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            animation: pulse-primary 2s infinite;
        }

        .copy-btn:hover {
            background-color: #d95d36; /* Cobre m√°s brillante */
            box-shadow: 0 0 15px rgba(201, 76, 38, 0.7);
            animation-play-state: paused; /* Pausa pulso al pasar mouse */
        }
        
        .copy-btn.success {
            background-color: var(--accent-green);
            color: white;
            animation: none; /* Sin pulso al √©xito */
        }

        /* 6. Secci√≥n de Preparaci√≥n y Cristaler√≠a */
        .preparation-container, .glassware-container {
            margin-bottom: 1rem;
        }
        .prep-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* (NUEVO) Bot√≥n Selector Principal */
        .selector-btn {
            width: 100%;
            padding: 0.8rem 1rem;
            background: var(--bg-main);
            border: 1px dashed var(--text-secondary);
            color: var(--text-secondary);
            border-radius: 10px;
            text-align: left;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .selector-btn:hover {
            border-color: var(--color-accent);
            color: var(--color-accent);
        }
        .selector-btn.selected { /* Estado cuando se selecciona algo */
            color: var(--text-primary);
            border-style: solid;
            border-color: var(--color-primary);
        }
        .selector-btn.selected-glass { /* Color distinto para vaso */
            border-color: var(--color-accent);
        }

        /* Grilla DENTRO del modal */
        .prep-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
        }
        
        /* Botones DENTRO del modal */
        .prep-btn {
            padding: 0.8rem 0.5rem;
            font-size: 0.9rem;
            background: var(--bg-main);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .prep-btn:hover {
            border-color: var(--color-accent);
            color: var(--color-accent);
        }
        
        /* Bot√≥n de preparaci√≥n activo (Cobre) */
        .prep-btn.active {
            background: var(--color-primary);
            color: var(--text-primary);
            border-color: var(--color-primary);
            font-weight: 600;
            box-shadow: 0 0 10px rgba(201, 76, 38, 0.5);
        }
        
        /* Bot√≥n de vaso activo (Dorado) */
        .glass-btn.active {
            background: var(--color-accent);
            color: var(--bg-main);
            border-color: var(--color-accent);
            font-weight: 600;
            box-shadow: 0 0 10px rgba(227, 178, 60, 0.5);
        }


        /* 7. Secci√≥n Aleatoria */
        .random-container {
            margin-bottom: 1.5rem;
            margin-top: 0.5rem; /* Ajuste por sacar las grillas */
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .random-btn {
            width: 100%;
            padding: 0.8rem;
            background: transparent;
            border: 2px solid var(--color-accent); /* Borde Dorado */
            color: var(--color-accent);
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .random-btn:hover {
            background: var(--color-accent);
            color: var(--bg-main);
            box-shadow: 0 0 15px rgba(227, 178, 60, 0.5);
        }
        
        .random-result-display {
            display: none;
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(227, 178, 60, 0.1);
            border: 1px dashed var(--color-accent);
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            animation: fadeIn 0.3s ease;
        }

        .random-result-display:hover {
            background: var(--color-accent);
        }

        /* Estilos texto random */
        .random-category-label {
            display: block;
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 400;
            text-transform: uppercase;
            transition: color 0.3s;
        }
        .random-ingredient-name {
            display: block;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--color-accent);
            transition: color 0.3s;
        }
        #randomResultDisplay:hover .random-category-label {
            color: var(--bg-main);
            opacity: 0.8;
        }
        #randomResultDisplay:hover .random-ingredient-name {
            color: var(--bg-main);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 8. Buscador e Inventar (Sticky) */
        .search-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            position: sticky;
            top: 0;
            z-index: 10;
            background: var(--bg-glass); /* Fondo Glassmorphism */
            backdrop-filter: blur(5px);
            padding: 1rem 0;
            margin-top: -1rem;
        }

        .search-container {
            position: relative;
            flex-grow: 1;
        }

        .search-input {
            width: 100%;
            padding: 0.8rem 2.2rem 0.8rem 2.5rem; /* Ajuste padding derecho para la X */
            background: var(--bg-main);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        .search-input:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 10px rgba(227, 178, 60, 0.5);
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Bot√≥n de limpiar b√∫squeda (X) */
        .search-clear-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            display: none; /* Oculto por defecto */
            padding: 0 5px;
        }
        .search-clear-btn:hover {
            color: var(--color-primary);
        }

        .invent-btn {
            padding: 0 1rem;
            background: transparent;
            border: 1px dashed var(--color-accent);
            color: var(--color-accent);
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .invent-btn:hover {
            background: rgba(227, 178, 60, 0.1);
        }

        /* 9. Lista de Ingredientes (Acorde√≥n) */
        .ingredients-list {
            width: 100%;
            padding-top: 0.5rem;
        }

        .accordion-item {
            margin-bottom: 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            overflow: hidden;
            background: var(--bg-main);
        }
        .accordion-header {
            width: 100%;
            padding: 0.8rem 1rem;
            background: var(--bg-glass-light);
            color: var(--text-primary);
            border: none;
            text-align: left;
            font-size: 1.1rem;
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }
        .accordion-header:hover {
            background: #333;
        }
        .accordion-header.active { color: var(--color-primary); }
        .accordion-header.active .accordion-icon { transform: rotate(180deg); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; background: transparent; }
        
        .subcategory-title {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px dashed var(--border-color);
            margin-top: 0.5rem;
        }

        .ingredient-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 0.5rem;
            padding: 0.8rem;
        }

        .ingredient-btn {
            padding: 0.5rem;
            font-size: 0.8rem;
            background: var(--bg-main);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 45px;
            display: flex; align-items: center; justify-content: center; text-align: center;
        }
        /* Efecto LUMINOSO pedido */
        .ingredient-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
            box-shadow: 0 0 10px rgba(201, 76, 38, 0.5);
            transform: translateY(-2px);
        }

        /* 10. Modales */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000;
            opacity: 0; visibility: hidden; transition: opacity 0.3s;
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }

        .modal-content {
            background: var(--bg-glass);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid var(--border-color); /* Borde gen√©rico */
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 90%; max-width: 450px; /* Ancho unificado */
            text-align: center;
        }
        /* Borde dorado para modales de selecci√≥n */
        #quantityModal .modal-content, #customModal .modal-content {
            border-color: var(--color-accent);
        }

        .modal-title { /* T√≠tulo gen√©rico */
            font-family: 'Poppins', sans-serif;
            color: var(--color-accent);
            font-size: 1.4rem;
            margin-bottom: 1.5rem;
            font-weight: 400;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .slider-container {
            margin-bottom: 2rem;
        }

        .slider-value-display {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }
        .slider-unit { font-size: 1rem; color: var(--text-secondary); font-weight: 400; }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]:focus { outline: none; }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 8px; cursor: pointer;
            background: var(--border-color); border-radius: 4px;
        }
        input[type=range]::-webkit-slider-thumb {
            height: 24px; width: 24px; border-radius: 50%;
            background: var(--color-primary); /* Slider Cobre */
            cursor: pointer;
            -webkit-appearance: none; margin-top: -8px;
            box-shadow: 0 0 10px rgba(201, 76, 38, 0.5);
        }

        .add-btn {
            width: 100%;
            padding: 1rem;
            background: var(--color-primary);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            border: none; border-radius: 10px;
            cursor: pointer; margin-bottom: 1.5rem;
            transition: all 0.3s;
        }
        .add-btn:hover {
            background-color: #d95d36;
            box-shadow: 0 0 15px rgba(201, 76, 38, 0.7);
        }
        .add-btn:active { transform: scale(0.98); }

        .extras-label {
            font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 1px;
        }
        .extras-grid {
            display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;
        }
        .extra-btn {
            padding: 0.5rem 0.8rem;
            background: transparent; border: 1px solid var(--border-color);
            color: var(--text-secondary); border-radius: 20px;
            font-size: 0.8rem; cursor: pointer; transition: all 0.3s;
        }
        .extra-btn:hover { border-color: var(--color-accent); color: var(--color-accent); }

        .cancel-link {
            color: var(--text-secondary);
            text-decoration: underline; cursor: pointer; font-size: 0.9rem;
            margin-top: 1rem;
            display: inline-block;
        }
        
        .custom-input {
            width: 100%; padding: 1rem; background: var(--bg-main); border: 1px solid var(--border-color); color: white;
            border-radius: 10px; margin-bottom: 1rem; font-size: 1.1rem;
        }

        /* 11. Animaciones y Responsividad */
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @media (max-width: 600px) {
            .top-inputs { flex-direction: column; gap: 0.5rem; }
            .main-panel { padding: 1rem; }
        }
    </style>
</head>
<body>

    <div class="bartender-app">
        <header>
            <h1>Bar Manager</h1>
        </header>

        <main class="main-panel">
            
            <!-- 1. Inputs Superiores -->
            <div class="top-inputs">
                <div class="input-group">
                    <label>Nombre C√≥ctel</label>
                    <input type="text" id="cocktailName" placeholder="Ej: Negroni Sbagliato">
                </div>
                <div class="input-group">
                    <label>Bartender</label>
                    <input type="text" id="creatorName" placeholder="Tu nombre">
                </div>
            </div>

            <!-- 2. Receta Actual -->
            <div class="recipe-container">
                <div class="recipe-header">
                    <h2>Receta en Curso</h2>
                    <span id="recipeCount" style="font-size:0.8rem; color:#666">0 Ingredientes</span>
                </div>
                <div class="recipe-output" id="recipeOutput">
                    <p class="placeholder">La copa est√° vac√≠a...</p>
                </div>
                
                <!-- Contenedor de Etiquetas -->
                <div class="recipe-tags-footer">
                    <span id="preparationTag" class="prep-tag-footer"></span>
                    <span id="glassTag" class="prep-tag-footer"></span>
                </div>
                
                <button id="copyRecipeBtn" class="copy-btn">üìã Copiar al Portapapeles</button>
            </div>

            <!-- 3. M√âTODO DE PREPARACI√ìN (MODIFICADO) -->
            <div class="preparation-container">
                <h3 class="prep-title">M√©todo de Preparaci√≥n</h3>
                <button id="selectPrepBtn" class="selector-btn">Seleccionar M√©todo...</button>
            </div>

            <!-- 4. CRISTALER√çA / VASO (MODIFICADO) -->
            <div class="glassware-container">
                <h3 class="prep-title">Cristaler√≠a / Vaso</h3>
                <button id="selectGlassBtn" class="selector-btn">Seleccionar Vaso...</button>
            </div>

            <!-- 5. SECCI√ìN ALEATORIA -->
            <div class="random-container">
                <button id="randomIngredientBtn" class="random-btn">
                    üé≤ Sorpr√©ndeme (Elegir Random)
                </button>
                <!-- Bot√≥n que aparece tras elegir -->
                <div id="randomResultDisplay" class="random-result-display">
                    <span id="randomCategoryLabel" class="random-category-label">Categor√≠a</span>
                    <span id="randomIngredientName" class="random-ingredient-name">Ingrediente</span>
                </div>
            </div>

            <!-- 6. Buscador e Inventar (Sticky) -->
            <div class="search-row">
                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInput" class="search-input" placeholder="Buscar (ej: 'Tequila', 'Lim√≥n'...)">
                    <!-- BOT√ìN BORRAR B√öSQUEDA -->
                    <button id="clearSearchBtn" class="search-clear-btn">‚úï</button>
                </div>
                <button id="inventBtn" class="invent-btn">+ Crear</button>
            </div>

            <!-- 7. Lista de Ingredientes -->
            <div class="ingredients-list" id="ingredientsContainer">
                <!-- Se llena din√°micamente -->
            </div>

        </main>
    </div>

    <!-- MODAL INGREDIENTE (SLIDER) -->
    <div id="quantityModal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modalIngredientName" class="modal-title">Ingrediente</h3>
            
            <!-- Slider Section -->
            <div class="slider-container">
                <div class="slider-value-display">
                    <span id="sliderDisplayValue">1</span> <span class="slider-unit">oz</span>
                </div>
                <input type="range" min="0.25" max="3" step="0.25" value="1" id="quantitySlider">
            </div>

            <button id="addIngredientBtn" class="add-btn">AGREGAR</button>

            <!-- Extras -->
            <div class="extras-label">Otras Medidas</div>
            <div class="extras-grid">
                <button class="extra-btn" data-extra="Dash">Dash</button>
                <button class="extra-btn" data-extra="Splash">Splash</button>
                <button class="extra-btn" data-extra="Garnish">Garnish</button>
                <button class="extra-btn" data-extra="Top Up">Top Up</button>
            </div>

            <div id="modalClose" class="cancel-link">Cancelar</div>
        </div>
    </div>

    <!-- MODAL INVENTAR -->
    <div id="customModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title">Nuevo Ingrediente</h3>
            <input type="text" id="customIngInput" class="custom-input" placeholder="Nombre del ingrediente...">
            <button id="confirmCustomBtn" class="add-btn">CONTINUAR</button>
            <div id="closeCustomBtn" class="cancel-link">Cancelar</div>
        </div>
    </div>

    <!-- MODAL M√âTODO DE PREPARACI√ìN (NUEVO) -->
    <div id="prepModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title">M√©todo de Preparaci√≥n</h3>
            <div class="prep-grid" id="prepGridModal">
                <button class="prep-btn" data-method="Shake">Shake</button>
                <button class="prep-btn" data-method="Stir">Stir</button>
                <button class="prep-btn" data-method="Build">Build</button>
                <button class="prep-btn" data-method="Blend">Blend</button>
                <button class="prep-btn" data-method="Throwing">Throwing</button>
                <button class="prep-btn" data-method="Rolling">Rolling</button>
                <button class="prep-btn" data-method="Muddling">Muddling</button>
            </div>
            <div id="closePrepModal" class="cancel-link">Cancelar</div>
        </div>
    </div>

    <!-- MODAL CRISTALER√çA (NUEVO) -->
    <div id="glassModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title">Cristaler√≠a / Vaso</h3>
            <div class="prep-grid" id="glassGridModal">
                <!-- Usamos 'glass-btn' para el estilo 'active' dorado -->
                <button class="prep-btn glass-btn" data-glass="Rock">Rock</button>
                <button class="prep-btn glass-btn" data-glass="Collins">Collins</button>
                <button class="prep-btn glass-btn" data-glass="Vino">Vino</button>
                <button class="prep-btn glass-btn" data-glass="Spritz">Spritz</button>
                <button class="prep-btn glass-btn" data-glass="Cop√≥n">Cop√≥n</button>
                <button class="prep-btn glass-btn" data-glass="Margarita">Margarita</button>
                <button class="prep-btn glass-btn" data-glass="Copper Mug">Copper Mug</button>
                <button class="prep-btn glass-btn" data-glass="Tiki">Tiki</button>
            </div>
            <div id="closeGlassModal" class="cancel-link">Cancelar</div>
        </div>
    </div>


    <script>
        /* --- DATOS --- */
        const rawData = {
            "Vinos üç∑": [
                "Gato dulce ros√©", "Reserva Casillero del Diablo Chardonnay", "Ind√≥mita Gran Reserva Carmenere", "Asado y Parrilla Cabernet Sauvignon", "Morand√© Pionero Reserva Cab. Sauv.", "Andr√©s Plateau Red Blend", "Oveja Negra Cab. Franc Carmenere Res.", "Oveja Negra Reserva Carmenere Merlot", "Diablo Black Cabernet Sauvignon", "Reserva Casillero del Diablo Cab. Sauv.", "Misiones de Rengo Cabernet Sauvignon", "Vi√±a Tarapac√° Cabernet Sauvignon", "Err√°zuriz Max Reserva Cabernet Sauvignon", "Santa Ema Merlot"
            ],
            "Destilados üç∏": {
                "Whisky ü•É": ["Johnnie Walker Red Label", "Johnnie Walker Black Label", "Fireball Cinnamon Whisky", "Crown Royal", "Crown Royal Apple"],
                "Pisco ü•Ç": ["Pisco Moai", "Horc√≥n Quemado 1 a√±o", "Horc√≥n Quemado 15 a√±os", "Capisco", "Alto del Carmen 35¬∞", "Alto del Carmen Cristalino 40¬∞", "Alto del Carmen 1.5 L 35¬∞", "Republicano Cristalino 40¬∞", "El Gobernador Reserva", "El Gobernador Especial 35¬∞", "Kapa", "Pisco del Per√∫ 42¬∞", "Mistral Gran Nobel 40¬∞", "Mistral Nobel 40¬∞", "Mistral 35¬∞", "Pisco Espiritu del Elqui 40¬∞"],
                "Gin üç∏": ["Beefeater Pink", "Beefeater London Dry", "Bombay Sapphire", "Bombay Bramble Blackberry", "Bosford‚Äôs London Dry", "Tra Kal", "Bulldog", "Soneto 22", "Tanqueray Sevilla"],
                "Ron üçπ": ["Havana Club Especial", "Pampero Especial", "Barcel√≥ Dorado A√±ejo", "Ron Barcel√≥ A√±ejo", "Bacard√≠ Carta Oro", "Bacard√≠ Carta Blanca", "Ron Sierra Morena Blanco", "Malib√∫"],
                "Vodka üç∏": ["Absolut", "Eristoff", "Eristoff Triple Premium", "Stolichnaya", "Skyy Vodka", "Vodka.pl Cranberry", "Vodka.pl Pear"],
                "Tequila & Mezcal ü•É": ["El Merendero Blanco", "Sombrero Negro Blanco", "Sombrero Negro Joven", "Agave Jalisco Silver", "Cazadores Reposado", "La Reliquia Mezcal Joven"],
                "Cognac ü•É": ["Tres Palos", "Hennessy Very Special"]
            },
            "Jugos C√≠tricos üçã": ["Jugo de Lim√≥n", "Jugo de Naranja", "Jugo de Pomelo"],
            "Pulpas ü•≠": ["Mango", "Maracuy√°", "Frutilla", "Frambuesa"],
            "Syrup üçØ": ["Goma simple"],
            "Licor y Cremas üçä": ["Licor Crema de Cacao Virgilio Busco", "Tres Torres Crema de Cassis", "Mitjans Caf√©", "Mitjans Triple Sec", "Mitjans Amaretto", "Mitjans Amaretto Premium", "Mitjans Cura√ßao", "Mitjans Licor de Cassis", "Mitjans Licor de Cacao", "Mitjans Licor de Cherry", "Licores √Åguila Cura√ßao", "Duval Menta Glacial", "Tres Torres Crema de Menta", "Licor Apricot", "Benidorm Cura√ßao Blue", "Tres Torres Triple Sec", "Gardens Licor de Cassis", "Tres Torres Manzanilla", "Licor de Jaboticaba", "Kahl√∫a", "Baileys", "Cr√®me de Pistacho", "Litmus"],
            "Amaros, Bitters y Aperitivos üåø": {
                "Bitter & Amaro üßâ": ["Bitter Extra", "Araucano", "Bitter Ojo", "J√§germeister", "J√§germeister Cold Brew", "Amargo Arom√°tico Aguilar"],
                "Vermouth üç∑": ["Vermouth Rosso", "Martini Vermouth Bianco", "Martini Fiero", "Rossard Bianco", "Rossard Rosso"],
                "Spritz & Aperitivos üçä": ["Ramazzotti Violeto", "Ramazzotti Rosato", "Rossard Spritz Flor de Sa√∫co", "Rossard Spritz Hibiscus", "Rossard Spritz Aranciata", "Villa Cardea Aperitivo Spritz"],
                "Digestivos üå∞": ["Fernet Rossard", "Fernet Branca", "Contreau", "Drambuie", "An√≠s del Mono"]
            },
            "Vinos Licorosos / Dulces üçá": ["Diamante vino licoroso dulce", "Centenario vino licoroso"],
            "Siropes y Otros üçì": ["Granadina", "Estrella del Elqui Pisco Sour", "Ginger Beer Britvic", "Agua T√≥nica Canada Dry", "Ginger Ale Canada Dry", "Agua sin gas Vital", "Agua con gas Vital", "Espumante Brut"]
        };

        document.addEventListener('DOMContentLoaded', () => {
            
            /* Elementos DOM */
            const ingredientsContainer = document.getElementById('ingredientsContainer');
            const searchInput = document.getElementById('searchInput');
            const clearSearchBtn = document.getElementById('clearSearchBtn');
            
            // Random
            const randomIngredientBtn = document.getElementById('randomIngredientBtn');
            const randomResultDisplay = document.getElementById('randomResultDisplay');
            
            // Modal Ingrediente
            const quantityModal = document.getElementById('quantityModal');
            const modalClose = document.getElementById('modalClose');
            const quantitySlider = document.getElementById('quantitySlider');
            const sliderDisplayValue = document.getElementById('sliderDisplayValue');
            const addIngredientBtn = document.getElementById('addIngredientBtn');
            const extraBtns = document.querySelectorAll('.extra-btn');

            // Receta
            const recipeOutput = document.getElementById('recipeOutput');
            const copyRecipeBtn = document.getElementById('copyRecipeBtn');
            const recipeCount = document.getElementById('recipeCount');

            // Custom
            const inventBtn = document.getElementById('inventBtn');
            const customModal = document.getElementById('customModal');
            const customIngInput = document.getElementById('customIngInput');
            const confirmCustomBtn = document.getElementById('confirmCustomBtn');
            const closeCustomBtn = document.getElementById('closeCustomBtn');

            // --- Elementos de Preparaci√≥n y Vaso (MODIFICADOS) ---
            const selectPrepBtn = document.getElementById('selectPrepBtn');
            const prepModal = document.getElementById('prepModal');
            const prepGridModal = document.getElementById('prepGridModal');
            const closePrepModal = document.getElementById('closePrepModal');
            const preparationTag = document.getElementById('preparationTag');
            
            const selectGlassBtn = document.getElementById('selectGlassBtn');
            const glassModal = document.getElementById('glassModal');
            const glassGridModal = document.getElementById('glassGridModal');
            const closeGlassModal = document.getElementById('closeGlassModal');
            const glassTag = document.getElementById('glassTag');


            // --- ESTADO Global ---
            let currentRecipe = [];
            let selectedIngredient = null;
            let currentRandomIngredient = null; 
            let allIngredientsList = []; 
            let currentPreparation = null; 
            let currentGlass = null; 

            /* --- PREPARAR LISTA PLANA PARA RANDOM --- */
            function flattenIngredients() {
                allIngredientsList = [];
                for (const [category, content] of Object.entries(rawData)) {
                    if (Array.isArray(content)) {
                        content.forEach(name => {
                            allIngredientsList.push({ name: name, category: category });
                        });
                    } else {
                        for (const [subCat, subItems] of Object.entries(content)) {
                            const fullCategory = `${category} / ${subCat}`;
                            subItems.forEach(name => {
                                allIngredientsList.push({ name: name, category: fullCategory });
                            });
                        }
                    }
                }
            }
            flattenIngredients();

            /* --- L√ìGICA BOT√ìN ALEATORIO --- */
            randomIngredientBtn.addEventListener('click', () => {
                if (allIngredientsList.length === 0) return;
                const randomIndex = Math.floor(Math.random() * allIngredientsList.length);
                currentRandomIngredient = allIngredientsList[randomIndex]; 
                document.getElementById('randomCategoryLabel').textContent = currentRandomIngredient.category;
                document.getElementById('randomIngredientName').textContent = currentRandomIngredient.name;
                randomResultDisplay.style.display = "block";
            });

            randomResultDisplay.addEventListener('click', () => {
                if (currentRandomIngredient) {
                    selectedIngredient = currentRandomIngredient.name; 
                    openModal(selectedIngredient);
                }
            });

            /* --- L√ìGICA DE PREPARACI√ìN (MODIFICADA) --- */
            
            // Abrir modal de Preparaci√≥n
            selectPrepBtn.addEventListener('click', () => {
                prepModal.classList.add('visible');
            });
            
            // Cerrar modal de Preparaci√≥n
            closePrepModal.addEventListener('click', () => {
                prepModal.classList.remove('visible');
            });
            prepModal.addEventListener('click', (e) => { // Cerrar al hacer clic afuera
                if (e.target === prepModal) prepModal.classList.remove('visible');
            });

            // Seleccionar item de preparaci√≥n
            prepGridModal.addEventListener('click', (e) => {
                const target = e.target.closest('.prep-btn');
                if (!target) return;
                const method = target.dataset.method;

                currentPreparation = (currentPreparation === method) ? null : method;

                prepGridModal.querySelectorAll('.prep-btn').forEach(btn => btn.classList.remove('active'));

                if (currentPreparation) {
                    target.classList.add('active');
                    selectPrepBtn.textContent = currentPreparation;
                    selectPrepBtn.classList.add('selected');
                } else {
                    selectPrepBtn.textContent = 'Seleccionar M√©todo...';
                    selectPrepBtn.classList.remove('selected');
                }
                
                renderPreparationTag();
                prepModal.classList.remove('visible'); // Cerrar al seleccionar
            });

            function renderPreparationTag() {
                if (currentPreparation) {
                    preparationTag.textContent = `M√©todo: ${currentPreparation}`;
                    preparationTag.style.display = 'inline-block';
                } else {
                    preparationTag.style.display = 'none';
                }
            }

            /* --- L√ìGICA DE CRISTALER√çA (MODIFICADA) --- */

            // Abrir modal de Vaso
            selectGlassBtn.addEventListener('click', () => {
                glassModal.classList.add('visible');
            });

            // Cerrar modal de Vaso
            closeGlassModal.addEventListener('click', () => {
                glassModal.classList.remove('visible');
            });
            glassModal.addEventListener('click', (e) => { // Cerrar al hacer clic afuera
                if (e.target === glassModal) glassModal.classList.remove('visible');
            });

            // Seleccionar item de vaso
            glassGridModal.addEventListener('click', (e) => {
                const target = e.target.closest('.prep-btn');
                if (!target) return;
                const glass = target.dataset.glass;

                currentGlass = (currentGlass === glass) ? null : glass;

                glassGridModal.querySelectorAll('.prep-btn').forEach(btn => btn.classList.remove('active'));

                if (currentGlass) {
                    target.classList.add('active');
                    selectGlassBtn.textContent = currentGlass;
                    selectGlassBtn.classList.add('selected', 'selected-glass');
                } else {
                    selectGlassBtn.textContent = 'Seleccionar Vaso...';
                    selectGlassBtn.classList.remove('selected', 'selected-glass');
                }
                
                renderGlassTag();
                glassModal.classList.remove('visible'); // Cerrar al seleccionar
            });

            function renderGlassTag() {
                if (currentGlass) {
                    glassTag.textContent = `Vaso: ${currentGlass}`;
                    glassTag.style.display = 'inline-block';
                } else {
                    glassTag.style.display = 'none';
                }
            }


            /* --- FUNCIONES SLIDER --- */
            function updateSliderDisplay() {
                const val = parseFloat(quantitySlider.value);
                let display = val;
                if (val === 0.25) display = "1/4";
                else if (val === 0.5) display = "1/2";
                else if (val === 0.75) display = "3/4";
                else if (val === 1.25) display = "1 1/4";
                else if (val === 1.5) display = "1 1/2";
                else if (val === 1.75) display = "1 3/4";
                else if (val === 2.25) display = "2 1/4";
                else if (val === 2.5) display = "2 1/2";
                else if (val === 2.75) display = "2 3/4";
                sliderDisplayValue.textContent = display;
            }
            
            quantitySlider.addEventListener('input', updateSliderDisplay);

            /* --- L√ìGICA DE B√öSQUEDA AVANZADA --- */
            function checkMatch(text, queryTokens) {
                const lowerText = text.toLowerCase();
                return queryTokens.every(token => lowerText.includes(token));
            }

            function renderMenu(searchTerm = "") {
                ingredientsContainer.innerHTML = "";
                const trimmedSearch = searchTerm.trim().toLowerCase();
                const searchTokens = trimmedSearch.length > 0 ? trimmedSearch.split(" ") : [];
                let foundAny = false;

                if (trimmedSearch.length > 0) {
                    clearSearchBtn.style.display = 'block';
                } else {
                    clearSearchBtn.style.display = 'none';
                }

                for (const [category, content] of Object.entries(rawData)) {
                    const accordionItem = document.createElement('div');
                    accordionItem.className = 'accordion-item';
                    const header = document.createElement('button');
                    header.className = 'accordion-header';
                    header.innerHTML = `<span>${category}</span><span class="accordion-icon">‚ñº</span>`;
                    const body = document.createElement('div');
                    body.className = 'accordion-content';
                    let hasMatch = false;
                    let categoryHtml = "";
                    const categoryMatch = checkMatch(category, searchTokens);

                    if (Array.isArray(content)) {
                        if (categoryMatch && searchTokens.length > 0) {
                             hasMatch = true;
                             categoryHtml += `<div class="ingredient-grid">`;
                             content.forEach(ing => categoryHtml += `<div class="ingredient-btn" data-name="${ing}">${ing}</div>`);
                             categoryHtml += `</div>`;
                        } else {
                            const filtered = content.filter(item => checkMatch(`${category} ${item}`, searchTokens));
                            if (filtered.length > 0) {
                                hasMatch = true;
                                categoryHtml += `<div class="ingredient-grid">`;
                                filtered.forEach(ing => categoryHtml += `<div class="ingredient-btn" data-name="${ing}">${ing}</div>`);
                                categoryHtml += `</div>`;
                            }
                        }
                    } else {
                        for (const [subCat, subItems] of Object.entries(content)) {
                            const subCatMatch = checkMatch(subCat, searchTokens) || categoryMatch;
                            if (subCatMatch && searchTokens.length > 0) {
                                hasMatch = true;
                                categoryHtml += `<div class="subcategory-title">${subCat}</div>`;
                                categoryHtml += `<div class="ingredient-grid">`;
                                subItems.forEach(ing => categoryHtml += `<div class="ingredient-btn" data-name="${ing}">${ing}</div>`);
                                categoryHtml += `</div>`;
                            } else {
                                const subFiltered = subItems.filter(item => checkMatch(`${category} ${subCat} ${item}`, searchTokens));
                                if (subFiltered.length > 0) {
                                    hasMatch = true;
                                    categoryHtml += `<div class="subcategory-title">${subCat}</div>`;
                                    categoryHtml += `<div class="ingredient-grid">`;
                                    subFiltered.forEach(ing => categoryHtml += `<div class="ingredient-btn" data-name="${ing}">${ing}</div>`);
                                    categoryHtml += `</div>`;
                                }
                            }
                        }
                    }

                    if (hasMatch) {
                        foundAny = true;
                        body.innerHTML = categoryHtml;
                        accordionItem.appendChild(header);
                        accordionItem.appendChild(body);
                        ingredientsContainer.appendChild(accordionItem);
                        header.addEventListener('click', () => {
                            header.classList.toggle('active');
                            body.style.maxHeight = header.classList.contains('active') ? body.scrollHeight + "px" : 0;
                        });
                        if (trimmedSearch !== "") {
                            header.classList.add('active');
                            body.style.maxHeight = "none"; 
                        }
                    }
                }
                if (!foundAny && trimmedSearch !== "") {
                    ingredientsContainer.innerHTML = `<div style="text-align:center; color:#666; padding:2rem;">Sin resultados para "${trimmedSearch}"</div>`;
                }
            }

            renderMenu();
            searchInput.addEventListener('keyup', (e) => renderMenu(e.target.value));

            /* --- L√ìGICA BOT√ìN LIMPIAR --- */
            clearSearchBtn.addEventListener('click', () => {
                searchInput.value = '';
                renderMenu(); 
                searchInput.focus();
            });

            /* --- EVENTOS INGREDIENTES --- */
            ingredientsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('ingredient-btn')) {
                    selectedIngredient = e.target.dataset.name;
                    openModal(selectedIngredient);
                }
            });

            /* --- MODAL LOGIC (Ingrediente) --- */
            function openModal(name) {
                document.getElementById('modalIngredientName').textContent = name;
                quantitySlider.value = 1;
                updateSliderDisplay();
                quantityModal.classList.add('visible');
            }

            function closeModal() {
                quantityModal.classList.remove('visible');
                selectedIngredient = null;
            }

            modalClose.addEventListener('click', closeModal);

            addIngredientBtn.addEventListener('click', () => {
                const amountText = sliderDisplayValue.textContent + " oz";
                addIngredientToRecipe(selectedIngredient, amountText);
                closeModal();
            });

            extraBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const amount = btn.dataset.extra;
                    addIngredientToRecipe(selectedIngredient, amount);
                    closeModal();
                });
            });

            /* --- CUSTOM INGREDIENT --- */
            inventBtn.addEventListener('click', () => {
                customIngInput.value = '';
                customModal.classList.add('visible');
                customIngInput.focus();
            });
            closeCustomBtn.addEventListener('click', () => customModal.classList.remove('visible'));
            confirmCustomBtn.addEventListener('click', () => {
                const name = customIngInput.value.trim();
                if (name) {
                    customModal.classList.remove('visible');
                    selectedIngredient = name + " (Custom)";
                    openModal(selectedIngredient);
                }
            });

            /* --- RECIPE MANAGEMENT --- */
            function addIngredientToRecipe(name, amount) {
                currentRecipe.push({ name, amount });
                renderRecipe();
                randomResultDisplay.style.display = "none";
                currentRandomIngredient = null; 
            }

            function renderRecipe() {
                recipeOutput.innerHTML = '';
                recipeCount.textContent = `${currentRecipe.length} Ingredientes`;

                if (currentRecipe.length === 0) {
                    recipeOutput.innerHTML = '<p class="placeholder">La copa est√° vac√≠a...</p>';
                    return;
                }
                
                currentRecipe.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'recipe-item';
                    div.innerHTML = `
                        <span class="ingredient-name">${item.name}</span>
                        <span class="dots"></span>
                        <span class="amount">${item.amount}</span>
                        <span style="margin-left:10px; cursor:pointer; color:#ff5555; font-weight:bold;" onclick="removeIngredient(${index})">√ó</span>
                    `;
                    recipeOutput.appendChild(div);
                });
                recipeOutput.scrollTop = recipeOutput.scrollHeight;
            }

            window.removeIngredient = function(index) {
                currentRecipe.splice(index, 1);
                renderRecipe();
            }

            /* --- COPY FUNCTION --- */
            copyRecipeBtn.addEventListener('click', () => {
                if(currentRecipe.length === 0 && !currentPreparation && !currentGlass) return; 
                
                const cocktailName = document.getElementById('cocktailName').value || "C√≥ctel Sin Nombre";
                const creator = document.getElementById('creatorName').value || "An√≥nimo";
                
                let textToCopy = `üç∏ *${cocktailName.toUpperCase()}*\n`;
                textToCopy += `üë§ Bartender: ${creator}\n`;
                
                if (currentPreparation) {
                    textToCopy += `‚öôÔ∏è Preparaci√≥n: *${currentPreparation}*\n`;
                }

                if (currentGlass) {
                    textToCopy += `Vaso: ${currentGlass}\n`;
                }
                
                textToCopy += `------------------------------\n`;
                
                if (currentRecipe.length > 0) {
                    currentRecipe.forEach(item => {
                        textToCopy += `‚Ä¢ ${item.name} ... ${item.amount}\n`;
                    });
                } else {
                    textToCopy += `(Sin ingredientes seleccionados)\n`;
                }

                textToCopy += `------------------------------\n`;
                textToCopy += `üìÖ ${new Date().toLocaleDateString()}`;

                const el = document.createElement('textarea');
                el.value = textToCopy;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);

                const originalText = copyRecipeBtn.textContent;
                copyRecipeBtn.textContent = "‚úÖ ¬°Copiado!";
                copyRecipeBtn.classList.add('success');
                setTimeout(() => {
                    copyRecipeBtn.textContent = originalText;
                    copyRecipeBtn.classList.remove('success');
                }, 2000);
            });
        });
    </script>
</body>
</html>